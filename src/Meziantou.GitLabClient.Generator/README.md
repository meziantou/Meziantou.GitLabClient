# Generator

The code of the GitLab client is generated by this project.

## Concept


- Enumeration serialized as number:

    ````csharp
    public static ModelRef AccessLevel { get; } = CreateEnumeration()
            .AddMember("guest", 10)
            .AddMember("reporter", 20)
            .AddMember("developer", 30)
            .AddMember("maintainer", 40)
            .AddMember("owner", 50);
    ````
- Enumeration serialized as string:

    ````csharp
    public static ModelRef MergeRequestState { get; } = CreateStringEnumeration()
            .AddMembers("opened", "closed", "locked", "merged");
    ````

- Entities:

    ````csharp
    public static EntityBuilder Issue { get; } = CreateEntity(entity => entity
            .AddProperty("id", ModelRef.NumberId)
            .AddProperty("iid", ModelRef.NumberId, PropertyOptions.IsKey)         // Key properties are used in Equals / GetHashCode / ToString methods
            .AddProperty("author", Models.UserBasic)
            .AddProperty("title", ModelRef.String, PropertyOptions.IsDisplayName) // Display properties are used in ToString method
            .AddProperty("project_id", ModelRef.NumberId, PropertyOptions.IsKey)
            .AddProperty("web_url", ModelRef.Uri)
            .AddProperty("created_at", ModelRef.DateTime)
            .AddProperty("updated_at", ModelRef.DateTime)
            .AddProperty("closed_at", ModelRef.NullableDateTime)
            .AddProperty("closed_by", Models.UserBasic.MakeNullable())
    );
    ````

- EntityRefs: Define struct that are used in queries when multiple data types are allows (e.g. Project path or project id)


    ````csharp
    public static ParameterEntityBuilder ProjectIdOrPathRef { get; } = CreateParameterEntity(entity =>
        entity.SetRefs(
            ParameterEntityRef.Create("projectId", ModelRef.NumberId),
            ParameterEntityRef.Create("project", Models.ProjectIdentity), // Use KeyProperties automatically
            ParameterEntityRef.Create("projectPathWithNamespace", ModelRef.PathWithNamespace))
    );
    ````

- Clients: Define the methods exposed by GitLab

    ````csharp
    internal sealed class IssuesClient : GitLabClientBuilder
    {
        protected override void Create(MethodGroup methodGroup)
        {
            methodGroup.AddMethod("Create", MethodType.Post, "/projects/:id/issues", "https://docs.gitlab.com/ee/api/issues.html#new-issue")
                .WithReturnType(Models.Issue)
                .AddRequiredParameter("id", Models.ProjectIdOrPathRef)
                .AddRequiredParameter("title", ModelRef.String)
                .AddOptionalParameter("description", ModelRef.String)
                .AddOptionalParameter("confidential", ModelRef.Boolean)
                ;
        }
    }
    ````

